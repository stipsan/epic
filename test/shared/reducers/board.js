import expect from 'expect'
import { board as reducer } from '../../../shared/reducers/board'
import * as types from '../../../shared/constants/ActionTypes'

describe('board reducer', () => {
  it('should return the initial state', () => {
    expect(
      reducer(undefined, {}).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  
  it('should place items', () => {
    const placedXl = reducer(undefined, {
      type: types.ADD_ITEM,
      item: 'xl',
      position: [2,3]
    })
    expect(
      placedXl.toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 1, 1, 1, 1, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 32, 33, 34, 35, 36],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
    const placedL = reducer(placedXl, {
      type: types.ADD_ITEM,
      item: 'l',
      position: [1,2]
    })
    expect(
      placedL.toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 2, 2, 2, 2, 0, 0, 0, 0, 0,
          0, 0, 1, 1, 1, 1, 1, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 32, 33, 34, 35, 36],
          l:   [0, 21, 22, 23, 24],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
    const placedM1 = reducer(placedL, {
      type: types.ADD_ITEM,
      item: 'm1',
      position: [8,1],
      rotated: 1
    })
    expect(
      placedM1.toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 3, 0,
          0, 2, 2, 2, 2, 0, 0, 0, 3, 0,
          0, 0, 1, 1, 1, 1, 1, 0, 3, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 32, 33, 34, 35, 36],
          l:   [0, 21, 22, 23, 24],
          m1:  [1, 18, 28, 38],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
    const placedM2 = reducer(placedM1, {
      type: types.ADD_ITEM,
      item: 'm2',
      position: [0,5]
    })
    expect(
      placedM2.toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 3, 0,
          0, 2, 2, 2, 2, 0, 0, 0, 3, 0,
          0, 0, 1, 1, 1, 1, 1, 0, 3, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          4, 4, 4, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 32, 33, 34, 35, 36],
          l:   [0, 21, 22, 23, 24],
          m1:  [1, 18, 28, 38],
          m2:  [0, 50, 51, 52],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
    const placedS1 = reducer(placedM2, {
      type: types.ADD_ITEM,
      item: 's1',
      position: [5,5],
      rotated: 1
    })
    expect(
      placedS1.toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 3, 0,
          0, 2, 2, 2, 2, 0, 0, 0, 3, 0,
          0, 0, 1, 1, 1, 1, 1, 0, 3, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          4, 4, 4, 0, 0, 5, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 5, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 32, 33, 34, 35, 36],
          l:   [0, 21, 22, 23, 24],
          m1:  [1, 18, 28, 38],
          m2:  [0, 50, 51, 52],
          s1:  [1, 55, 65],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
    
    const placedS2 = reducer(placedS1, {
      type: types.ADD_ITEM,
      item: 's2',
      position: [6,7]
    })
    expect(
      placedS2.toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 3, 0,
          0, 2, 2, 2, 2, 0, 0, 0, 3, 0,
          0, 0, 1, 1, 1, 1, 1, 0, 3, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          4, 4, 4, 0, 0, 5, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 5, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 6, 6, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 32, 33, 34, 35, 36],
          l:   [0, 21, 22, 23, 24],
          m1:  [1, 18, 28, 38],
          m2:  [0, 50, 51, 52],
          s1:  [1, 55, 65],
          s2:  [0, 76, 77],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
    
    const placedXs1 = reducer(placedS2, {
      type: types.ADD_ITEM,
      item: 'xs1',
      position: [0,0]
    })
    expect(
      placedXs1.toJS()
    ).toEqual(
      {
        grid: [
          7, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 3, 0,
          0, 2, 2, 2, 2, 0, 0, 0, 3, 0,
          0, 0, 1, 1, 1, 1, 1, 0, 3, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          4, 4, 4, 0, 0, 5, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 5, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 6, 6, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 32, 33, 34, 35, 36],
          l:   [0, 21, 22, 23, 24],
          m1:  [1, 18, 28, 38],
          m2:  [0, 50, 51, 52],
          s1:  [1, 55, 65],
          s2:  [0, 76, 77],
          xs1: [0, 0],
          xs2: [0, -1]
        }
      }
    )
    
    const placedXs2 = reducer(placedXs1, {
      type: types.ADD_ITEM,
      item: 'xs2',
      position: [9,9]
    })
    expect(
      placedXs2.toJS()
    ).toEqual(
      {
        grid: [
          7, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 3, 0,
          0, 2, 2, 2, 2, 0, 0, 0, 3, 0,
          0, 0, 1, 1, 1, 1, 1, 0, 3, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          4, 4, 4, 0, 0, 5, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 5, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 6, 6, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 8,
        ],
        items: {
          xl:  [0, 32, 33, 34, 35, 36],
          l:   [0, 21, 22, 23, 24],
          m1:  [1, 18, 28, 38],
          m2:  [0, 50, 51, 52],
          s1:  [1, 55, 65],
          s2:  [0, 76, 77],
          xs1: [0, 0],
          xs2: [0, 99]
        }
      }
    )
    
  })
  
  it('should not add items with x = -1', () => {
    expect(
      reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [-1,0]
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
    
  })
  it('should not add items with y = -1', () => {
    expect(
      reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [0,-1]
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )

  })
  it('should not add items with x >= 10', () => {
    expect(
      reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [10,5],
        rotated: 1
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should not add items with y >= 10', () => {
    expect(
      reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [0,10]
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should prevent larger items from causing x-axis overflow', () => {
    expect(
      reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [9,5]
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should prevent larger items from causing y-axis overflow', () => {
    expect(
      reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [5,9],
        rotated: 1
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should prevent adding already added item', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xs1',
        position: [0,0]
      }), {
        type: types.ADD_ITEM,
        item: 'xs1',
        position: [1,0]
      }).toJS()
    ).toEqual(
      {
        grid: [
          7, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, 0],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should prevent overlap on previous item on x-axis when adding items', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [0,0]
      }), {
        type: types.ADD_ITEM,
        item: 'l',
        position: [3,0]
      }).toJS()
    ).toEqual(
      {
        grid: [
          1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 0, 1, 2, 3, 4],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should prevent overlap on next item on x-axis when adding items', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [5,0]
      }), {
        type: types.ADD_ITEM,
        item: 'l',
        position: [3,0]
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 5, 6, 7, 8, 9],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should prevent overlap on previous item on y-axis when adding items', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [2,1],
        rotated: 1
      }), {
        type: types.ADD_ITEM,
        item: 'l',
        position: [2,3],
        rotated: 1
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [1, 12, 22, 32, 42, 52],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should prevent overlap on previous item on y-axis when adding items', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [2,1],
        rotated: 1
      }), {
        type: types.ADD_ITEM,
        item: 'l',
        position: [2,0],
        rotated: 1
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [1, 12, 22, 32, 42, 52],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should prevent x-axis overlap on y-axis items when adding items', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [2,1],
        rotated: 1
      }), {
        type: types.ADD_ITEM,
        item: 'l',
        position: [0,2]
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [1, 12, 22, 32, 42, 52],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should prevent y-axis overlap on x-axis items when adding items', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [0,2]
      }), {
        type: types.ADD_ITEM,
        item: 'l',
        position: [2,0],
        rotated: 1
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 20, 21, 22, 23, 24],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should rotate items x to y', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [4,4]
      }), {
        type: types.ROTATE_ITEM,
        item: 'xl',
        rotated: 1
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [1, 44, 54, 64, 74, 84],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should not overflow when rotating items x to y', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [4,8]
      }), {
        type: types.ROTATE_ITEM,
        item: 'xl',
        rotated: 1
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 1, 1, 1, 1, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 84, 85, 86, 87, 88],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should rotate items y to x', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [4,4],
        rotated: 1
      }), {
        type: types.ROTATE_ITEM,
        item: 'xl',
        rotated: 0
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 1, 1, 1, 1, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 44, 45, 46, 47, 48],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should not overflow when rotating items y to x', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [8,4],
        rotated: 1
      }), {
        type: types.ROTATE_ITEM,
        item: 'xl',
        rotated: 0
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 1, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 1, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 1, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 1, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 1, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [1, 48, 58, 68, 78, 88],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should not overlap when rotating items x to y', () => {
    expect(
      reducer(reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'l',
        position: [4,6],
        rotated: 1
      }), {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [4,4]
      }), {
        type: types.ROTATE_ITEM,
        item: 'xl',
        rotated: 1
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 1, 1, 1, 1, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 2, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 2, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 2, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 2, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 44, 45, 46, 47, 48],
          l:   [1, 64, 74, 84, 94],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should not overlap when rotating items y to x', () => {
    expect(
      reducer(reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'l',
        position: [6,4],
        rotated: 1
      }), {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [4,4],
        rotated: 1
      }), {
        type: types.ROTATE_ITEM,
        item: 'xl',
        rotated: 0
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 2, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 2, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 2, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 2, 0, 0, 0,
          0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [1, 44, 54, 64, 74, 84],
          l:   [1, 46, 56, 66, 76],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should move items', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [4,4]
      }), {
        type: types.MOVE_ITEM,
        item: 'xl',
        position: [0,0]
      }).toJS()
    ).toEqual(
      {
        grid: [
          1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 0, 1, 2, 3, 4],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should move items without overlap', () => {
    expect(
      reducer(reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'l',
        position: [0,0]
      }), {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [4,4]
      }), {
        type: types.MOVE_ITEM,
        item: 'xl',
        position: [0,0]
      }).toJS()
    ).toEqual(
      {
        grid: [
          2, 2, 2, 2, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 1, 1, 1, 1, 1, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 44, 45, 46, 47, 48],
          l:   [0, 0, 1, 2, 3],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should move items without overflow', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [0,0]
      }), {
        type: types.MOVE_ITEM,
        item: 'xl',
        position: [9,9]
      }).toJS()
    ).toEqual(
      {
        grid: [
          1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, 0, 1, 2, 3, 4],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should remove items', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [0,0],
        rotated: 1
      }), {
        type: types.REMOVE_ITEM,
        item: 'xl'
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [1, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should reset items', () => {
    expect(
      reducer(reducer(undefined, {
        type: types.ADD_ITEM,
        item: 'xl',
        position: [0,0],
        rotated: 1
      }), {
        type: types.RESET_ITEMS
      }).toJS()
    ).toEqual(
      {
        grid: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        items: {
          xl:  [0, -1, -1, -1, -1, -1],
          l:   [0, -1, -1, -1, -1],
          m1:  [0, -1, -1, -1],
          m2:  [0, -1, -1, -1],
          s1:  [0, -1, -1],
          s2:  [0, -1, -1],
          xs1: [0, -1],
          xs2: [0, -1]
        }
      }
    )
  })
  it('should load saved board layout', () => {
    const board = {
      grid: [
        7, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 3, 0,
        0, 2, 2, 2, 2, 0, 0, 0, 3, 0,
        0, 0, 1, 1, 1, 1, 1, 0, 3, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        4, 4, 4, 0, 0, 5, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 5, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 6, 6, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 8,
      ],
      items: {
        xl:  [0, 32, 33, 34, 35, 36],
        l:   [0, 21, 22, 23, 24],
        m1:  [1, 18, 28, 38],
        m2:  [0, 50, 51, 52],
        s1:  [1, 55, 65],
        s2:  [0, 76, 77],
        xs1: [0, 0],
        xs2: [0, 99]
      }
    }
    expect(
      reducer(undefined, {
        type: types.LOAD_ITEMS,
        board
      }).toJS()
    ).toEqual(board)
  })
})